

<!DOCTYPE html>
<html lang="zh-CN" data-default-color-scheme=auto>



<head>
  <meta charset="UTF-8">
  <link rel="apple-touch-icon" sizes="76x76" href="/img/favicon_ico.png">
  <link rel="icon" href="/img/favicon_ico.png">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="description" content="分享总结个人的学习路程">
  <meta name="author" content="屠雍">
  <meta name="keywords" content="PCB, 单片机, 物联网, 嵌入式, Java, Linux, Web前端">
  <meta name="description" content="MyBatis 速成手册  MyBatis 是一款优秀的持久层框架，它支持定制化 SQL、存储过程以及高级映射。MyBatis 避免了几乎所有的 JDBC 代码和手动设置参数以及获取结果集。MyBatis 可以使用简单的 XML 或注解来配置和映射原生信息，将接口和 Java 的 POJOs(Plain Ordinary Java Object,普通的 Java对象)映射成数据库中的记录。 既然M">
<meta property="og:type" content="article">
<meta property="og:title" content="MyBatis 速成手册">
<meta property="og:url" content="http://example.com/2021/10/13/MyBatis%20%E9%80%9F%E6%88%90%E6%89%8B%E5%86%8C/index.html">
<meta property="og:site_name" content="小贝比">
<meta property="og:description" content="MyBatis 速成手册  MyBatis 是一款优秀的持久层框架，它支持定制化 SQL、存储过程以及高级映射。MyBatis 避免了几乎所有的 JDBC 代码和手动设置参数以及获取结果集。MyBatis 可以使用简单的 XML 或注解来配置和映射原生信息，将接口和 Java 的 POJOs(Plain Ordinary Java Object,普通的 Java对象)映射成数据库中的记录。 既然M">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2021-10-13T14:16:00.316Z">
<meta property="article:modified_time" content="2021-10-13T10:03:43.424Z">
<meta property="article:author" content="屠雍">
<meta property="article:tag" content="Java">
<meta property="article:tag" content="Mybatis">
<meta name="twitter:card" content="summary_large_image">
  
  <title>MyBatis 速成手册 - 小贝比</title>

  <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/css/bootstrap.min.css" />


  <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/github-markdown-css@4/github-markdown.min.css" />
  <link  rel="stylesheet" href="/lib/hint/hint.min.css" />

  
    
    
      
      <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@10/styles/atom-one-dark.min.css" />
    
  

  
    <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3/dist/jquery.fancybox.min.css" />
  


<!-- 主题依赖的图标库，不要自行修改 -->

<link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_ba1fz6golrf.css">



<link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_kmeydafke9r.css">


<link  rel="stylesheet" href="/css/main.css" />

<!-- 自定义样式保持在最底部 -->


  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    var CONFIG = {"hostname":"example.com","root":"/","version":"1.8.12","typing":{"enable":true,"typeSpeed":70,"cursorChar":"_","loop":false},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"right","visible":"hover","icon":""},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":100}},"copy_btn":true,"image_zoom":{"enable":true,"img_url_replace":["",""]},"toc":{"enable":true,"headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":0},"lazyload":{"enable":true,"loading_img":"/img/loading.gif","onlypost":false,"offset_factor":2},"web_analytics":{"enable":false,"baidu":null,"google":null,"gtag":null,"tencent":{"sid":null,"cid":null},"woyaola":null,"cnzz":null,"leancloud":{"app_id":null,"app_key":null,"server_url":null,"path":"window.location.pathname"}},"search_path":"/local-search.xml"};
  </script>
  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>
<meta name="generator" content="Hexo 5.4.0"></head>


<body>
  <header style="height: 70vh;">
    <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand" href="/">
      <strong>小贝比的个人博客</strong>
    </a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/">
                <i class="iconfont icon-home-fill"></i>
                首页
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/">
                <i class="iconfont icon-archive-fill"></i>
                归档
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/">
                <i class="iconfont icon-category-fill"></i>
                分类
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/">
                <i class="iconfont icon-tags-fill"></i>
                标签
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/">
                <i class="iconfont icon-user-fill"></i>
                关于
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/links/">
                <i class="iconfont icon-link-fill"></i>
                友链
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search">
              &nbsp;<i class="iconfont icon-search"></i>&nbsp;
            </a>
          </li>
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle">&nbsp;<i
                class="iconfont icon-dark" id="color-toggle-icon"></i>&nbsp;</a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

    <div class="banner" id="banner" parallax=true
         style="background: url('/img/background7.jpg') no-repeat center center;
           background-size: cover;">
      <div class="full-bg-img">
        <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
          <div class="page-header text-center fade-in-up">
            <span class="h2" id="subtitle" title="MyBatis 速成手册">
              
            </span>

            
              <div class="mt-3">
  
  
    <span class="post-meta">
      <i class="iconfont icon-date-fill" aria-hidden="true"></i>
      <time datetime="2021-10-13 22:16" pubdate>
        2021年10月13日 晚上
      </time>
    </span>
  
</div>

<div class="mt-1">
  
    <span class="post-meta mr-2">
      <i class="iconfont icon-chart"></i>
      29k 字
    </span>
  

  
    <span class="post-meta mr-2">
      <i class="iconfont icon-clock-fill"></i>
      
      
      91 分钟
    </span>
  

  
  
</div>

            
          </div>

          
        </div>
      </div>
    </div>
  </header>

  <main>
    
      

<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="d-none d-lg-block col-lg-2"></div>
    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div class="py-5" id="board">
          <article class="post-content mx-auto">
            <!-- SEO header -->
            <h1 style="display: none">MyBatis 速成手册</h1>
            
            <div class="markdown-body">
              <center><h2>MyBatis 速成手册</h2></center>

<p>MyBatis 是一款优秀的持久层框架，它支持定制化 SQL、存储过程以及高级映射。MyBatis 避免了几乎所有的 JDBC 代码和手动设置参数以及获取结果集。MyBatis 可以使用简单的 XML 或注解来配置和映射原生信息，将接口和 Java 的 POJOs(Plain Ordinary Java Object,普通的 Java对象)映射成数据库中的记录。</p>
<p>既然MyBatis有如此多的优势，那么下面就一起来看看MyBatis的用法吧。</p>
<h2 id="入门案例"><a href="#入门案例" class="headerlink" title="入门案例"></a><strong>入门案例</strong></h2><p>现有一张数据表：</p>
<figure class="highlight sql"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs sql">mysql<span class="hljs-operator">&gt;</span> use mybatis;<br>Database changed<br>mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> tbl_employee;<br><span class="hljs-operator">+</span><span class="hljs-comment">----+-----------+--------+-------------+</span><br><span class="hljs-operator">|</span> id <span class="hljs-operator">|</span> last_name <span class="hljs-operator">|</span> gender <span class="hljs-operator">|</span> email <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">----+-----------+--------+-------------+</span><br><span class="hljs-operator">|</span>  <span class="hljs-number">1</span> <span class="hljs-operator">|</span> tom <span class="hljs-operator">|</span> <span class="hljs-number">0</span>      <span class="hljs-operator">|</span> tom<span class="hljs-variable">@163</span>.com <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">----+-----------+--------+-------------+</span><br><span class="hljs-number">1</span> <span class="hljs-type">row</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">set</span> (<span class="hljs-number">0.00</span> sec)<br></code></pre></div></td></tr></table></figure>

<p>该如何通过MyBatis对其进行查询？首先创建对应的Java类：</p>
<figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.wwj.mybatis.bean;<br><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Employee</span> </span>&#123;<br> <br> <span class="hljs-keyword">private</span> Integer id;<br> <span class="hljs-keyword">private</span> String lastName;<br> <span class="hljs-keyword">private</span> String email;<br> <span class="hljs-keyword">private</span> String gender;<br> <br> <span class="hljs-function"><span class="hljs-keyword">public</span> Integer <span class="hljs-title">getId</span><span class="hljs-params">()</span> </span>&#123;<br>  <span class="hljs-keyword">return</span> id;<br> &#125;<br> <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setId</span><span class="hljs-params">(Integer id)</span> </span>&#123;<br>  <span class="hljs-keyword">this</span>.id = id;<br> &#125;<br> <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">getLastName</span><span class="hljs-params">()</span> </span>&#123;<br>  <span class="hljs-keyword">return</span> lastName;<br> &#125;<br> <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setLastName</span><span class="hljs-params">(String lastName)</span> </span>&#123;<br>  <span class="hljs-keyword">this</span>.lastName = lastName;<br> &#125;<br> <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">getEmail</span><span class="hljs-params">()</span> </span>&#123;<br>  <span class="hljs-keyword">return</span> email;<br> &#125;<br> <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setEmail</span><span class="hljs-params">(String email)</span> </span>&#123;<br>  <span class="hljs-keyword">this</span>.email = email;<br> &#125;<br> <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">getGender</span><span class="hljs-params">()</span> </span>&#123;<br>  <span class="hljs-keyword">return</span> gender;<br> &#125;<br> <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setGender</span><span class="hljs-params">(String gender)</span> </span>&#123;<br>  <span class="hljs-keyword">this</span>.gender = gender;<br> &#125;<br> <br> <span class="hljs-meta">@Override</span><br> <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">toString</span><span class="hljs-params">()</span> </span>&#123;<br>  <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;Employee [id=&quot;</span> + id + <span class="hljs-string">&quot;, lastName=&quot;</span> + lastName + <span class="hljs-string">&quot;, email=&quot;</span> + email + <span class="hljs-string">&quot;, gender=&quot;</span> + gender + <span class="hljs-string">&quot;]&quot;</span>;<br> &#125;<br>&#125;<br></code></pre></div></td></tr></table></figure>

<p>其次编写MyBatis的全局配置文件(mybatis-config.xml)：</p>
<figure class="highlight xml"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs xml"><span class="hljs-meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&gt;</span><br><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-meta-keyword">configuration</span></span><br><span class="hljs-meta">  <span class="hljs-meta-keyword">PUBLIC</span> <span class="hljs-meta-string">&quot;-//mybatis.org//DTD Config 3.0//EN&quot;</span></span><br><span class="hljs-meta">  <span class="hljs-meta-string">&quot;http://mybatis.org/dtd/mybatis-3-config.dtd&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">configuration</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">environments</span> <span class="hljs-attr">default</span>=<span class="hljs-string">&quot;development&quot;</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">environment</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;development&quot;</span>&gt;</span><br>   <span class="hljs-tag">&lt;<span class="hljs-name">transactionManager</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;JDBC&quot;</span>/&gt;</span><br>         <span class="hljs-tag">&lt;<span class="hljs-name">dataSource</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;POOLED&quot;</span>&gt;</span><br>           <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;driver&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;com.mysql.jdbc.Driver&quot;</span>/&gt;</span><br>           <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;url&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;jdbc:mysql:///mybatis&quot;</span>/&gt;</span><br>          <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;username&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;root&quot;</span>/&gt;</span><br>           <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;password&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;123456&quot;</span>/&gt;</span><br>         <span class="hljs-tag">&lt;/<span class="hljs-name">dataSource</span>&gt;</span><br>     <span class="hljs-tag">&lt;/<span class="hljs-name">environment</span>&gt;</span><br> <span class="hljs-tag">&lt;/<span class="hljs-name">environments</span>&gt;</span><br> <span class="hljs-tag">&lt;<span class="hljs-name">mappers</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">mapper</span> <span class="hljs-attr">resource</span>=<span class="hljs-string">&quot;EmployeeMapper.xml&quot;</span>/&gt;</span><br> <span class="hljs-tag">&lt;/<span class="hljs-name">mappers</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">configuration</span>&gt;</span><br></code></pre></div></td></tr></table></figure>

<p>全局配置文件中主要配置的是数据源信息，然后是最后的mappers标签，该标签配置的是sql语句的映射文件。</p>
<p>所以我们接着创建sql语句的映射文件(EmployeeMapper.xml)：</p>
<figure class="highlight xml"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs xml"><span class="hljs-meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&gt;</span><br><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-meta-keyword">mapper</span></span><br><span class="hljs-meta">  <span class="hljs-meta-keyword">PUBLIC</span> <span class="hljs-meta-string">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span></span><br><span class="hljs-meta">  <span class="hljs-meta-string">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">mapper</span> <span class="hljs-attr">namespace</span>=<span class="hljs-string">&quot;com.wwj.mybatis.bean.Employee&quot;</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">select</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;selectEmp&quot;</span> <span class="hljs-attr">resultType</span>=<span class="hljs-string">&quot;com.wwj.mybatis.bean.Employee&quot;</span>&gt;</span><br>     select id,last_name lastName,email,gender from tbl_employee where id = #&#123;id&#125;<br>   <span class="hljs-tag">&lt;/<span class="hljs-name">select</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">mapper</span>&gt;</span><br></code></pre></div></td></tr></table></figure>

<p>其中mapper标签的namespace属性设置的是需要映射的类全名；select标签表示查询语句，其中的id属性是该sql的唯一标识，resultType表示返回值的类型；然后在select标签中编写需要执行的sql语句。</p>
<p>一切准备就绪后，开始编写测试代码：</p>
<figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@Test</span><br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">test</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> IOException </span>&#123;<br> String resource = <span class="hljs-string">&quot;mybatis-config.xml&quot;</span>;<br> InputStream inputStream = Resources.getResourceAsStream(resource);<br> SqlSessionFactory sessionFactory = <span class="hljs-keyword">new</span> SqlSessionFactoryBuilder().build(inputStream);<br> SqlSession session = sessionFactory.openSession();<br> Employee employee = session.selectOne(<span class="hljs-string">&quot;com.wwj.mybatis.bean.Employee.selectEmp&quot;</span>,<span class="hljs-number">1</span>);<br> System.out.println(employee);<br> session.close();<br>&#125;<br></code></pre></div></td></tr></table></figure>

<p>通过全局的配置文件去创建一个SqlSessionFactory，并通过该对象获得SqlSession，就可以使用SqlSession进行增删改查了。这里调用了selectOne方法，表示从数据表中查询一行数据，其中的第一个参数需要填入刚才在sql映射文件中设置的id，但为了避免该id与其它sql语句重复，一般都会在id前加上namespace；第二个参数则是需要传入sql的参数。</p>
<h3 id="增删改查的新方式"><a href="#增删改查的新方式" class="headerlink" title="增删改查的新方式"></a><strong>增删改查的新方式</strong></h3><p>在入门案例中我们已经成功通过MyBatis查询了数据表的数据，但是这种方式的缺点也是显而易见的，为此，MyBatis提供了一种更加完美的方式来操作数据表。</p>
<p>定义一个接口：</p>
<figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.wwj.mybatis.dao;<br><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">EmployeeMapper</span> </span>&#123;<br> <br> <span class="hljs-function"><span class="hljs-keyword">public</span> Employee <span class="hljs-title">getEmpById</span><span class="hljs-params">(Integer id)</span></span>;<br>&#125;<br></code></pre></div></td></tr></table></figure>

<p>MyBatis神奇的地方就在于你不需要去实现该接口，只需要将该接口与对应的sql映射文件绑定即可，MyBatis会自动创建代理对象调用对应的方法。</p>
<p>所以我们需要对sql的映射文件做一个小小的改动：</p>
<figure class="highlight xml"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs xml"><span class="hljs-meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&gt;</span><br><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-meta-keyword">mapper</span></span><br><span class="hljs-meta">  <span class="hljs-meta-keyword">PUBLIC</span> <span class="hljs-meta-string">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span></span><br><span class="hljs-meta">  <span class="hljs-meta-string">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">mapper</span> <span class="hljs-attr">namespace</span>=<span class="hljs-string">&quot;com.wwj.mybatis.dao.EmployeeMapper&quot;</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">select</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;getEmpById&quot;</span> <span class="hljs-attr">resultType</span>=<span class="hljs-string">&quot;com.wwj.mybatis.bean.Employee&quot;</span>&gt;</span><br>     select id,last_name lastName,email,gender from tbl_employee where id = #&#123;id&#125;<br>   <span class="hljs-tag">&lt;/<span class="hljs-name">select</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">mapper</span>&gt;</span><br></code></pre></div></td></tr></table></figure>

<p>首先是namespace，现在该属性应该指向的是接口的全类名；然后是select标签的id属性，该属性也应该指向接口中对应的方法名，其它地方不变。</p>
<p>测试代码：</p>
<figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@Test</span><br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">test2</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> IOException</span>&#123;<br> String resource = <span class="hljs-string">&quot;mybatis-config.xml&quot;</span>;<br> InputStream inputStream = Resources.getResourceAsStream(resource);<br> SqlSessionFactory sessionFactory = <span class="hljs-keyword">new</span> SqlSessionFactoryBuilder().build(inputStream);<br> SqlSession session = sessionFactory.openSession();<br> <span class="hljs-comment">//Mybatis会为接口自动创建代理对象，并由代理对象执行增删改查</span><br> EmployeeMapper mapper = session.getMapper(EmployeeMapper.class);<br> Employee employee = mapper.getEmpById(<span class="hljs-number">1</span>);<br> System.out.println(employee);<br> session.close();<br>&#125;<br></code></pre></div></td></tr></table></figure>



<p>这里同样是通过全局配置文件创建SqlSessionFactory，并通过该对象获得SqlSession，不同的是，这里需要通过SqlSession对象调用getMapper方法去获得指定的接口的实现类，该实现类是MyBatis自动生成的代理对象，并通过该对象调用指定的方法完成数据表的操作。</p>
<h3 id="通过properties标签引入外部属性文件"><a href="#通过properties标签引入外部属性文件" class="headerlink" title="通过properties标签引入外部属性文件"></a><strong>通过properties标签引入外部属性文件</strong></h3><p>这个操作已经是再熟悉不过了，这里直接贴出代码：</p>
<figure class="highlight xml"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs xml"><span class="hljs-meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&gt;</span><br><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-meta-keyword">configuration</span></span><br><span class="hljs-meta">  <span class="hljs-meta-keyword">PUBLIC</span> <span class="hljs-meta-string">&quot;-//mybatis.org//DTD Config 3.0//EN&quot;</span></span><br><span class="hljs-meta">  <span class="hljs-meta-string">&quot;http://mybatis.org/dtd/mybatis-3-config.dtd&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">configuration</span>&gt;</span><br> <br> <span class="hljs-comment">&lt;!-- 使用properties标签引入外部的属性文件内容 --&gt;</span><br> <span class="hljs-tag">&lt;<span class="hljs-name">properties</span> <span class="hljs-attr">resource</span>=<span class="hljs-string">&quot;dbconfig.properties&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">properties</span>&gt;</span><br> <br>  <span class="hljs-tag">&lt;<span class="hljs-name">environments</span> <span class="hljs-attr">default</span>=<span class="hljs-string">&quot;development&quot;</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">environment</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;development&quot;</span>&gt;</span><br>   <span class="hljs-tag">&lt;<span class="hljs-name">transactionManager</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;JDBC&quot;</span>/&gt;</span><br>         <span class="hljs-tag">&lt;<span class="hljs-name">dataSource</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;POOLED&quot;</span>&gt;</span><br>           <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;driver&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;$&#123;jdbc.driver&#125;&quot;</span>/&gt;</span><br>           <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;url&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;$&#123;jdbc.url&#125;&quot;</span>/&gt;</span><br>          <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;username&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;$&#123;jdbc.username&#125;&quot;</span>/&gt;</span><br>           <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;password&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;$&#123;jdbc.password&#125;&quot;</span>/&gt;</span><br>         <span class="hljs-tag">&lt;/<span class="hljs-name">dataSource</span>&gt;</span><br>     <span class="hljs-tag">&lt;/<span class="hljs-name">environment</span>&gt;</span><br> <span class="hljs-tag">&lt;/<span class="hljs-name">environments</span>&gt;</span><br> <span class="hljs-tag">&lt;<span class="hljs-name">mappers</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">mapper</span> <span class="hljs-attr">resource</span>=<span class="hljs-string">&quot;EmployeeMapper.xml&quot;</span>/&gt;</span><br> <span class="hljs-tag">&lt;/<span class="hljs-name">mappers</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">configuration</span>&gt;</span><br></code></pre></div></td></tr></table></figure>

<h2 id="typeAliases"><a href="#typeAliases" class="headerlink" title="typeAliases"></a>typeAliases</h2><p>这是一个全局配置文件的标签，通过该标签能够为某个Java类型设置别名，比如：</p>
<figure class="highlight xml"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">typeAliases</span>&gt;</span><br> <span class="hljs-comment">&lt;!-- type:指定要起别名的类型全类名，默认别名为类名字母小写:employee</span><br><span class="hljs-comment">   也可以使用alias属性为其设置指定的别名</span><br><span class="hljs-comment"> --&gt;</span><br> <span class="hljs-tag">&lt;<span class="hljs-name">typeAlias</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;com.wwj.mybatis.bean.Employee&quot;</span> <span class="hljs-attr">alias</span>=<span class="hljs-string">&quot;employee&quot;</span>/&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">typeAliases</span>&gt;</span><br></code></pre></div></td></tr></table></figure>

<p>这样我们就可以修改sql映射文件中的返回值类型：</p>
<figure class="highlight xml"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">select</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;getEmpById&quot;</span> <span class="hljs-attr">resultType</span>=<span class="hljs-string">&quot;employee&quot;</span>&gt;</span><br>    select * from tbl_employee where id = #&#123;id&#125;<br><span class="hljs-tag">&lt;/<span class="hljs-name">select</span>&gt;</span><br></code></pre></div></td></tr></table></figure>

<p>该标签还能够批量起别名，比如：</p>
<figure class="highlight xml"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">typeAliases</span>&gt;</span><br> <span class="hljs-comment">&lt;!--</span><br><span class="hljs-comment">  批量起别名</span><br><span class="hljs-comment">  name:指定包名(为当前包及其子包下的所有类都起一个默认别名)</span><br><span class="hljs-comment"> --&gt;</span><br> <span class="hljs-tag">&lt;<span class="hljs-name">package</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;com.wwj.mybatis.bean&quot;</span>/&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">typeAliases</span>&gt;</span><br></code></pre></div></td></tr></table></figure>

<p>若是子包下也有一个重名的类，则MyBatis会因为别名重复而报错，为此，可以通过@Alias注解在类上设置新的别名。</p>
<h3 id="environments"><a href="#environments" class="headerlink" title="environments"></a><strong>environments</strong></h3><p>全局配置文件标签，可以通过其子标签environment配置多种环境，比如：</p>
<figure class="highlight xml"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">environments</span> <span class="hljs-attr">default</span>=<span class="hljs-string">&quot;development&quot;</span>&gt;</span><br> <span class="hljs-tag">&lt;<span class="hljs-name">environment</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;development&quot;</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">transactionManager</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;JDBC&quot;</span>/&gt;</span><br>      <span class="hljs-tag">&lt;<span class="hljs-name">dataSource</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;POOLED&quot;</span>&gt;</span><br>         <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;driver&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;$&#123;jdbc.driver&#125;&quot;</span>/&gt;</span><br>          <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;url&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;$&#123;jdbc.url&#125;&quot;</span>/&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;username&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;$&#123;jdbc.username&#125;&quot;</span>/&gt;</span><br>          <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;password&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;$&#123;jdbc.password&#125;&quot;</span>/&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">dataSource</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">environment</span>&gt;</span><br>     <br>    <span class="hljs-tag">&lt;<span class="hljs-name">environment</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;test&quot;</span>&gt;</span><br>     <span class="hljs-tag">&lt;<span class="hljs-name">transactionManager</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;JDBC&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">transactionManager</span>&gt;</span><br>     <span class="hljs-tag">&lt;<span class="hljs-name">dataSource</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;POOLED&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">dataSource</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">environment</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">environments</span>&gt;</span><br></code></pre></div></td></tr></table></figure>

<p>environment需要配置两个子标签：transactionManager和dataSource，否则就会报错。</p>
<p>transactionManager标签的type属性可以指定两个属性值：</p>
<ol>
<li>JDBC：这个配置直接使用了 JDBC 的提交和回滚设施，它依赖从数据源获得的连接来管理事务作用域</li>
<li>MANAGED：这个配置几乎没做什么。它从不提交或回滚一个连接，而是让容器来管理事务的整个生命周期(比如 JEE 应用服务器的上下文)， 默认情况下它会关闭连接</li>
</ol>
<p>dataSource标签的type属性可以指定三个属性值：</p>
<ol>
<li>UNPOOLED ：这个数据源的实现会每次请求时打开和关闭连接。虽然有点慢，但对那些数据库连接可用性要求不高的简单应用程序来说，是一个很好的选择。性能表现则依赖于使用的数据库，对某些数据库来说，使用连接池并不重要，这个配置就很适合这种情形。</li>
<li>POOLED：这种数据源的实现利用“池”的概念将 JDBC 连接对象组织起来，避免了创建新的连接实例时所必需的初始化和认证时间。这种处理方式很流行，能使并发 Web 应用快速响应请求</li>
<li>JNDI：这个数据源实现是为了能在如 EJB 或应用服务器这类容器中使用，容器可以集中或在外部配置数据源，然后放置一个 JNDI 上下文的数据源引用</li>
</ol>
<h2 id="mappers"><a href="#mappers" class="headerlink" title="mappers"></a>mappers</h2><p>sql映射文件标签，用于将sql映射注册到全局配置中，比如：</p>
<figure class="highlight xml"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">mappers</span>&gt;</span><br> <span class="hljs-tag">&lt;<span class="hljs-name">mapper</span> <span class="hljs-attr">resource</span>=<span class="hljs-string">&quot;EmployeeMapper.xml&quot;</span>/&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">mappers</span>&gt;</span><br></code></pre></div></td></tr></table></figure>

<p>使用子标签mapper注册一个sql映射。</p>
<p>mapper还有一个用法， 就是注册接口，比如：</p>
<figure class="highlight xml"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">mappers</span>&gt;</span><br> <span class="hljs-tag">&lt;<span class="hljs-name">mapper</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;com.wwj.mybatis.dao.EmployeeMapper&quot;</span>/&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">mappers</span>&gt;</span><br></code></pre></div></td></tr></table></figure>

<p>需要注意的是，若要通过这样的方式注册接口，则需要将该sql映射文件名设置为与接口名一致，并与接口放在同一目录下。</p>
<p>mappers同样支持批量注册，使用package标签即可，若使用批量注册，sql映射文件也需要与接口同目录，否则MyBatis将无法找到文件而报错。</p>
<h3 id="增删改查"><a href="#增删改查" class="headerlink" title="增删改查"></a><strong>增删改查</strong></h3><p>熟悉了MyBatis配置文件中的一些标签后，我们来看看MyBatis是如何实现增删改查操作的？</p>
<h3 id="插入数据"><a href="#插入数据" class="headerlink" title="插入数据"></a><strong>插入数据</strong></h3><p>仿照着实现查询的方式，我们很容易写出增删改查，先修改接口：</p>
<figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.wwj.mybatis.dao;<br><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">EmployeeMapper</span> </span>&#123;<br> <br> <span class="hljs-function"><span class="hljs-keyword">public</span> Employee <span class="hljs-title">getEmpById</span><span class="hljs-params">(Integer id)</span></span>;<br> <br> <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">addEmp</span><span class="hljs-params">(Employee employee)</span></span>;<br> <br> <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">updateEmp</span><span class="hljs-params">(Employee employee)</span></span>;<br> <br> <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">deleteEmp</span><span class="hljs-params">(Integer id)</span></span>;<br>&#125;<br></code></pre></div></td></tr></table></figure>

<p>在接口中新添加了三个方法，分别对应着增删改。</p>
<p>然后修改sql映射文件：</p>
<figure class="highlight xml"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs xml"><span class="hljs-meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&gt;</span><br><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-meta-keyword">mapper</span></span><br><span class="hljs-meta">  <span class="hljs-meta-keyword">PUBLIC</span> <span class="hljs-meta-string">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span></span><br><span class="hljs-meta">  <span class="hljs-meta-string">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">mapper</span> <span class="hljs-attr">namespace</span>=<span class="hljs-string">&quot;com.wwj.mybatis.dao.EmployeeMapper&quot;</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">select</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;getEmpById&quot;</span> <span class="hljs-attr">resultType</span>=<span class="hljs-string">&quot;employee&quot;</span>&gt;</span><br>     select * from tbl_employee where id = #&#123;id&#125;<br>   <span class="hljs-tag">&lt;/<span class="hljs-name">select</span>&gt;</span><br>   <br>   <span class="hljs-tag">&lt;<span class="hljs-name">insert</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;addEmp&quot;</span> <span class="hljs-attr">parameterType</span>=<span class="hljs-string">&quot;com.wwj.mybatis.bean.Employee&quot;</span>&gt;</span><br>    insert into tbl_employee(last_name,email,gender) values(#&#123;lastName&#125;,#&#123;email&#125;,#&#123;gender&#125;)<br>   <span class="hljs-tag">&lt;/<span class="hljs-name">insert</span>&gt;</span><br>   <br>   <span class="hljs-tag">&lt;<span class="hljs-name">update</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;updateEmp&quot;</span>&gt;</span><br>    update tbl_employee set last_name = #&#123;lastName&#125;,email = #&#123;email&#125;,gender = #&#123;gender&#125; where id = #&#123;id&#125;<br>   <span class="hljs-tag">&lt;/<span class="hljs-name">update</span>&gt;</span><br>   <br>   <span class="hljs-tag">&lt;<span class="hljs-name">delete</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;deleteEmp&quot;</span>&gt;</span><br>    delete from tbl_employee where id = #&#123;id&#125;<br>   <span class="hljs-tag">&lt;/<span class="hljs-name">delete</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">mapper</span>&gt;</span><br></code></pre></div></td></tr></table></figure>

<p>这已经很简单了，无需做过多解释，唯一要说的是parameterType属性，该属性的作用是指定方法参数的类型，该属性可以省略不写。这样准备工作就完成了，来测试一下：</p>
<figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@Test</span><br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">test3</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> IOException</span>&#123;<br> String resource = <span class="hljs-string">&quot;mybatis-config.xml&quot;</span>;<br> InputStream inputStream = Resources.getResourceAsStream(resource);<br> SqlSessionFactory sessionFactory = <span class="hljs-keyword">new</span> SqlSessionFactoryBuilder().build(inputStream);<br> SqlSession session = sessionFactory.openSession();<br> EmployeeMapper mapper = session.getMapper(EmployeeMapper.class);<br> Employee employee = <span class="hljs-keyword">new</span> Employee(<span class="hljs-keyword">null</span>,<span class="hljs-string">&quot;Jack&quot;</span>,<span class="hljs-string">&quot;jack@163.com&quot;</span>,<span class="hljs-string">&quot;1&quot;</span>);<br> mapper.addEmp(employee);<br> session.commit();<br> session.close();<br>&#125;<br></code></pre></div></td></tr></table></figure>

<p>需要注意的是，SqlSession是不会自动提交数据的，所以在进行增删改操作的时候，最后一定要记得提交。</p>
<h3 id="删除数据"><a href="#删除数据" class="headerlink" title="删除数据"></a><strong>删除数据</strong></h3><p>做删除操作只需要改变一下调用的方法即可：</p>
<figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@Test</span><br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">test3</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> IOException</span>&#123;<br> String resource = <span class="hljs-string">&quot;mybatis-config.xml&quot;</span>;<br> InputStream inputStream = Resources.getResourceAsStream(resource);<br> SqlSessionFactory sessionFactory = <span class="hljs-keyword">new</span> SqlSessionFactoryBuilder().build(inputStream);<br> SqlSession session = sessionFactory.openSession();<br> EmployeeMapper mapper = session.getMapper(EmployeeMapper.class);<br> mapper.deleteEmp(<span class="hljs-number">2</span>);<br> session.commit();<br> session.close();<br>&#125;<br></code></pre></div></td></tr></table></figure>

<h3 id="修改数据"><a href="#修改数据" class="headerlink" title="修改数据"></a>修改数据</h3><p>修改数据同样是这样：</p>
<figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@Test</span><br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">test3</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> IOException</span>&#123;<br> String resource = <span class="hljs-string">&quot;mybatis-config.xml&quot;</span>;<br> InputStream inputStream = Resources.getResourceAsStream(resource);<br> SqlSessionFactory sessionFactory = <span class="hljs-keyword">new</span> SqlSessionFactoryBuilder().build(inputStream);<br> SqlSession session = sessionFactory.openSession();<br> EmployeeMapper mapper = session.getMapper(EmployeeMapper.class);<br> Employee employee = <span class="hljs-keyword">new</span> Employee(<span class="hljs-number">1</span>,<span class="hljs-string">&quot;Jack&quot;</span>,<span class="hljs-string">&quot;jack@163.com&quot;</span>,<span class="hljs-string">&quot;0&quot;</span>);<br> mapper.updateEmp(employee);<br> session.commit();<br> session.close();<br>&#125;<br></code></pre></div></td></tr></table></figure>

<p>Mybatis还直接允许增删改操作直接定义以下返回值：Integer、Long、Boolean，直接在接口方法上定义即可，比如：</p>
<figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">EmployeeMapper</span> </span>&#123;<br> <br> <span class="hljs-function"><span class="hljs-keyword">public</span> Long <span class="hljs-title">addEmp</span><span class="hljs-params">(Employee employee)</span></span>;<br>&#125;<br></code></pre></div></td></tr></table></figure>

<h3 id="查询数据"><a href="#查询数据" class="headerlink" title="查询数据"></a><strong>查询数据</strong></h3><p>查询就不说了，入门案例已经写过了。</p>
<h4 id="获取自增主键的值"><a href="#获取自增主键的值" class="headerlink" title="获取自增主键的值"></a><strong>获取自增主键的值</strong></h4><p>MyBatis支持获取自增主键的值，而且非常方便：</p>
<figure class="highlight xml"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">insert</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;addEmp&quot;</span> <span class="hljs-attr">useGeneratedKeys</span>=<span class="hljs-string">&quot;true&quot;</span> <span class="hljs-attr">keyProperty</span>=<span class="hljs-string">&quot;id&quot;</span>&gt;</span><br>   insert into tbl_employee(last_name,email,gender) values(#&#123;lastName&#125;,#&#123;email&#125;,#&#123;gender&#125;)<br><span class="hljs-tag">&lt;/<span class="hljs-name">insert</span>&gt;</span><br></code></pre></div></td></tr></table></figure>

<p>只需要设置useGeneratedKeys属性值为true即可，MyBatis就会将主键的值封装到keyProperty属性指定的参数中，这里指定了id，表示将自增主键的值获取出来并存入Employee对象的id属性中，接下来要想获取主键的值就可以直接获取该对象的id属性了。</p>
<h4 id="参数处理"><a href="#参数处理" class="headerlink" title="参数处理"></a><strong>参数处理</strong></h4><p>下面介绍一下MyBatis对于参数的处理，在前面的案例中，我们都是通过<code>#&#123;参数名&#125;</code>的方式来获取参数，而事实上，对于单个的参数，MyBatis不会对其进行特殊处理，这个参数名是可以随便写的，写个a、b、c都可以，比如：</p>
<figure class="highlight xml"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">select</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;getEmpById&quot;</span> <span class="hljs-attr">resultType</span>=<span class="hljs-string">&quot;employee&quot;</span>&gt;</span><br>    select * from tbl_employee where id = #&#123;aaa&#125;<br><span class="hljs-tag">&lt;/<span class="hljs-name">select</span>&gt;</span><br></code></pre></div></td></tr></table></figure>

<p>那么对于多参数的方法该如何处理呢？</p>
<figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.wwj.mybatis.dao;<br><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">EmployeeMapper</span> </span>&#123;<br> <br> <span class="hljs-comment">//新增一个多参数的方法</span><br> <span class="hljs-function"><span class="hljs-keyword">public</span> Employee <span class="hljs-title">getEmpByIdAndLastName</span><span class="hljs-params">(String id,String lastName)</span></span>;<br> <br> <span class="hljs-function"><span class="hljs-keyword">public</span> Employee <span class="hljs-title">getEmpById</span><span class="hljs-params">(Integer id)</span></span>;<br> <br> <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">addEmp</span><span class="hljs-params">(Employee employee)</span></span>;<br> <br> <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">updateEmp</span><span class="hljs-params">(Employee employee)</span></span>;<br> <br> <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">deleteEmp</span><span class="hljs-params">(Integer id)</span></span>;<br>&#125;<br></code></pre></div></td></tr></table></figure>



<p>在接口中新增一个getEmpByIdAndLastName方法，并添加对应的sql配置：</p>
<figure class="highlight xml"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">select</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;getEmpByIdAndLastName&quot;</span> <span class="hljs-attr">resultType</span>=<span class="hljs-string">&quot;employee&quot;</span>&gt;</span><br>  select * from tbl_employee where id = #&#123;id&#125; and last_name = #&#123;lastName&#125;<br><span class="hljs-tag">&lt;/<span class="hljs-name">select</span>&gt;</span><br></code></pre></div></td></tr></table></figure>

<p>可能大家会想当然地这样写，但告诉大家，这样是错误的。</p>
<p>MyBatis会对多个参数进行特殊处理，将这些参数封装成一个map，所以我们需要从map中取值，如下：</p>
<figure class="highlight xml"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">select</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;getEmpByIdAndLastName&quot;</span> <span class="hljs-attr">resultType</span>=<span class="hljs-string">&quot;employee&quot;</span>&gt;</span><br>  select * from tbl_employee where id = #&#123;param1&#125; and last_name = #&#123;param2&#125;<br><span class="hljs-tag">&lt;/<span class="hljs-name">select</span>&gt;</span><br></code></pre></div></td></tr></table></figure>

<p>MyBatis有着自己的封装规则，它将传递过来的参数封装到map中，指定键为：param1、param2、param3．．．，而这些键对应的就是我们需要取出的值。</p>
<p>当然，你也可以这样写：</p>
<figure class="highlight xml"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">select</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;getEmpByIdAndLastName&quot;</span> <span class="hljs-attr">resultType</span>=<span class="hljs-string">&quot;employee&quot;</span>&gt;</span><br>  select * from tbl_employee where id = #&#123;0&#125; and last_name = #&#123;1&#125;<br><span class="hljs-tag">&lt;/<span class="hljs-name">select</span>&gt;</span><br></code></pre></div></td></tr></table></figure>

<p>通过索引获取map中的值。</p>
<h4 id="命名参数"><a href="#命名参数" class="headerlink" title="命名参数"></a><strong>命名参数</strong></h4><p>这两种获取参数方式的缺点是显而易见的，当参数足够多时，这样的参数名会使开发者眼花缭乱，为此，我们应该使用命名参数的方式进行参数值的获取。</p>
<p>这里需要借助@Param注解对map的键重命名：</p>
<figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-comment">//新增一个多参数的方法</span><br><span class="hljs-function"><span class="hljs-keyword">public</span> Employee <span class="hljs-title">getEmpByIdAndLastName</span><span class="hljs-params">(<span class="hljs-meta">@Param(&quot;id&quot;)</span>String id,<span class="hljs-meta">@Param(&quot;lastName&quot;)</span>String lastName)</span></span>;<br></code></pre></div></td></tr></table></figure>

<p>这样我们就能直接通过指定的参数名从map中获取值了：</p>
<figure class="highlight xml"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">select</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;getEmpByIdAndLastName&quot;</span> <span class="hljs-attr">resultType</span>=<span class="hljs-string">&quot;employee&quot;</span>&gt;</span><br>  select * from tbl_employee where id = #&#123;id&#125; and last_name = #&#123;lastName&#125;<br><span class="hljs-tag">&lt;/<span class="hljs-name">select</span>&gt;</span><br></code></pre></div></td></tr></table></figure>

<h4 id="处理POJO"><a href="#处理POJO" class="headerlink" title="处理POJO"></a><strong>处理POJO</strong></h4><p>若是传入的参数过多，而且正好符合业务逻辑的模型对象，我们就可以直接传入POJO，在取出数据值的时候就可以直接使用POJO的属性名：<code>#&#123;POJO属性名&#125;</code>。</p>
<p>而如果多个参数并不符合模型对象，为了方便，我们也可以自己将其封装成一个map，比如：</p>
<figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-comment">//新增一个多参数的方法</span><br><span class="hljs-function"><span class="hljs-keyword">public</span> Employee <span class="hljs-title">getEmpByIdAndLastName</span><span class="hljs-params">(Map&lt;String, Object&gt; map)</span></span>;<br></code></pre></div></td></tr></table></figure>

<p>那么你在传递参数的时候就需要传递一个map：</p>
<figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@Test</span><br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">test4</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> IOException</span>&#123;<br> String resource = <span class="hljs-string">&quot;mybatis-config.xml&quot;</span>;<br> InputStream inputStream = Resources.getResourceAsStream(resource);<br> SqlSessionFactory sessionFactory = <span class="hljs-keyword">new</span> SqlSessionFactoryBuilder().build(inputStream);<br> SqlSession session = sessionFactory.openSession();<br> <span class="hljs-comment">//Mybatis会为接口自动创建代理对象，并由代理对象执行增删改查</span><br> EmployeeMapper mapper = session.getMapper(EmployeeMapper.class);<br> Map&lt;String, Object&gt; map = <span class="hljs-keyword">new</span> HashMap&lt;String, Object&gt;();<br> map.put(<span class="hljs-string">&quot;id&quot;</span>, <span class="hljs-string">&quot;1&quot;</span>);<br> map.put(<span class="hljs-string">&quot;lastName&quot;</span>, <span class="hljs-string">&quot;Jack&quot;</span>);<br> Employee employee = mapper.getEmpByIdAndLastName(map);<br> System.out.println(employee);<br> session.close();<br>&#125;<br></code></pre></div></td></tr></table></figure>

<p>而在取出map数据的时候就可以直接通过键获取：</p>
<figure class="highlight xml"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">select</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;getEmpByIdAndLastName&quot;</span> <span class="hljs-attr">resultType</span>=<span class="hljs-string">&quot;employee&quot;</span>&gt;</span><br>  select * from tbl_employee where id = #&#123;id&#125; and last_name = #&#123;lastName&#125;<br><span class="hljs-tag">&lt;/<span class="hljs-name">select</span>&gt;</span><br></code></pre></div></td></tr></table></figure>

<p>特别需要注意的是，Mybatis会对Collection类型及数组做特殊处理，比如：</p>
<figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">public</span> Employee <span class="hljs-title">getEmpById</span><span class="hljs-params">(List&lt;Integer&gt; ids)</span></span>;<br></code></pre></div></td></tr></table></figure>

<p>该参数是一个id的集合，若是想从该集合中获取第一个id的值，则需要<code>#&#123;list[0]&#125;</code>。</p>
<p>因为对于Collection类型，包括：Collection、List、Set，MyBatis都会将其封装到map中，其对应的键为collection，如果是List类型，还可以使用<code>list</code>作为键，数组的键为<code>array</code>。</p>
<h4 id="与-的区别"><a href="#与-的区别" class="headerlink" title="#{}与${}的区别"></a><strong>#{}与${}的区别</strong></h4><p>MyBatis中除了可以使用#{}取值外，还可以使用${},它们的用法是相同的，那么这两种方式到底有什么区别呢？</p>
<p>我分别用#{}和${}进行取值，并执行测试代码，下面是运行结果：</p>
<figure class="highlight sql"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs sql">DEBUG <span class="hljs-number">04</span><span class="hljs-number">-16</span> <span class="hljs-number">13</span>:<span class="hljs-number">46</span>:<span class="hljs-number">27</span>,<span class="hljs-number">992</span> <span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">&gt;</span> Preparing: <span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> tbl_employee <span class="hljs-keyword">where</span> id <span class="hljs-operator">=</span> ? <span class="hljs-keyword">and</span> last_name <span class="hljs-operator">=</span> ? (BaseJdbcLogger.java:<span class="hljs-number">145</span>)<br><br>DEBUG <span class="hljs-number">04</span><span class="hljs-number">-16</span> <span class="hljs-number">14</span>:<span class="hljs-number">31</span>:<span class="hljs-number">13</span>,<span class="hljs-number">054</span> <span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">&gt;</span> Preparing: <span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> tbl_employee <span class="hljs-keyword">where</span> id <span class="hljs-operator">=</span> <span class="hljs-number">1</span> <span class="hljs-keyword">and</span> last_name <span class="hljs-operator">=</span> Jack (BaseJdbcLogger.java:<span class="hljs-number">145</span>)<br></code></pre></div></td></tr></table></figure>

<p>会发现，两者的区别在于，${}会将传递的参数显示到生成的sql语句上。</p>
<h4 id="select元素之resultMap"><a href="#select元素之resultMap" class="headerlink" title="select元素之resultMap"></a><strong>select元素之resultMap</strong></h4><p>select标签用来定义查询操作，其中有三个比较重要的参数：</p>
<ol>
<li>id：唯一标识符，用来引用这条语句，需要与接口的方法名一致</li>
<li>parameterType：参数类型，可以不传，MyBatis会根据TypeHandler自动判断</li>
<li>resultType：返回值类型，别名或者全类名，如果返回的是集合，则写的是集合中元素的类型；不能与resultMap同时使用</li>
</ol>
<p>在前面的案例中，我们已经使用过select标签，接下来让我们深入了解一下该标签。</p>
<p>比如在接口中定义这样的一个方法：</p>
<figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">public</span> List&lt;Employee&gt; <span class="hljs-title">getEmpsByLastNameLike</span><span class="hljs-params">(String lastName)</span></span>;<br></code></pre></div></td></tr></table></figure>

<p>该方法的返回值是集合类型，那么在编写sql配置的时候就得这样写：</p>
<figure class="highlight xml"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">select</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;getEmpsByLastNameLike&quot;</span> <span class="hljs-attr">resultType</span>=<span class="hljs-string">&quot;employee&quot;</span>&gt;</span><br>  select * from tbl_employee where last_name like #&#123;lastName&#125;<br><span class="hljs-tag">&lt;/<span class="hljs-name">select</span>&gt;</span><br></code></pre></div></td></tr></table></figure>

<p>resultType写的是集合中的元素类型。</p>
<p>若凡返回值是map类型，比如：</p>
<figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">public</span> Map&lt;String,Object&gt; <span class="hljs-title">getEmpMapById</span><span class="hljs-params">(Integer id)</span></span>;<br></code></pre></div></td></tr></table></figure>

<p>sql配置应该这样写：</p>
<figure class="highlight xml"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">select</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;getEmpMapById&quot;</span> <span class="hljs-attr">resultType</span>=<span class="hljs-string">&quot;map&quot;</span>&gt;</span><br>  select * from tbl_employee where id = #&#123;id&#125;<br><span class="hljs-tag">&lt;/<span class="hljs-name">select</span>&gt;</span><br></code></pre></div></td></tr></table></figure>

<p>resultType写的是map，为什么能够直接写map而不用写全类名，因为MyBatis已经帮我们取好了别名。</p>
<p>通过这样的方式，MyBatis会将表中的列名和记录作为键和值一一封装到map中。</p>
<p>我们还可以通过返回map来查询表中的某一行数据，并直接将其封装成对象返回：</p>
<figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@MapKey(&quot;id&quot;)</span><br><span class="hljs-function"><span class="hljs-keyword">public</span> Map&lt;Integer,Employee&gt; <span class="hljs-title">getEmpByLastNameLike</span><span class="hljs-params">(String lastName)</span></span>;<br></code></pre></div></td></tr></table></figure>

<p>该方法能将查询到的每一行数据封装成一个对象，其键由@MapKey注解指定，比如这里是指定以id为键，接下来是sql配置：</p>
<figure class="highlight xml"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">select</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;getEmpByLastNameLike&quot;</span> <span class="hljs-attr">resultType</span>=<span class="hljs-string">&quot;employee&quot;</span>&gt;</span><br>  select * from tbl_employee where last_name like #&#123;lastName&#125;<br><span class="hljs-tag">&lt;/<span class="hljs-name">select</span>&gt;</span><br></code></pre></div></td></tr></table></figure>

<p>resultType同样是集合元素类型，但是通过该sql查询返回的结果将是以id为键，对应的行数据为值的map集合。</p>
<p>当然，select标签可不止id、parameterType和resultType这三个参数，下面介绍一下该标签的另一个重要属性参数：resulyMap。</p>
<p>我们知道，通过resultType指定返回值类型后，MyBatis会自动将得到的数据封装进去，然而当数据表的列名和返回值属性不一致时，就会导致封装失败，这时候我们会有两种办法：一种就是设置别名；另一种就是使用resultMap来自定义返回值类型。</p>
<p>比如：</p>
<figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">public</span> Employee <span class="hljs-title">getEmpById</span><span class="hljs-params">(Integer id)</span></span>;<br></code></pre></div></td></tr></table></figure>

<p>按照之前的写法，应该是这样：</p>
<figure class="highlight xml"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">select</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;getEmpById&quot;</span> <span class="hljs-attr">resultType</span>=<span class="hljs-string">&quot;employee&quot;</span>&gt;</span><br>    select * from tbl_employee where id = #&#123;id&#125;<br> <span class="hljs-tag">&lt;/<span class="hljs-name">select</span>&gt;</span><br></code></pre></div></td></tr></table></figure>

<p>但现在，倘若Employee类中的某些属性名和表中的列名并不一致，此时MyBatis将无法进行自动封装，我们就需要通过resultMap来自定义封装规则。</p>
<figure class="highlight xml"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs xml"><span class="hljs-comment">&lt;!-- 自定义某个JavaBean的封装规则 --&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">resultMap</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;employee&quot;</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;emp&quot;</span>&gt;</span><br> <span class="hljs-comment">&lt;!--</span><br><span class="hljs-comment">   指定主键列的封装规则</span><br><span class="hljs-comment">   column:指定哪一列</span><br><span class="hljs-comment">   property:指定对应的JavaBean属性</span><br><span class="hljs-comment">  --&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">id</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;id&quot;</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;id&quot;</span>/&gt;</span><br>  <span class="hljs-comment">&lt;!-- 指定非主键列的封装规则 --&gt;</span><br>   <span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;last_name&quot;</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;lastName&quot;</span>/&gt;</span><br>   <span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;email&quot;</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;email&quot;</span>/&gt;</span><br>   <span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;gender&quot;</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;gender&quot;</span>/&gt;</span><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">resultMap</span>&gt;</span><br> <br><span class="hljs-tag">&lt;<span class="hljs-name">select</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;getEmpById&quot;</span> <span class="hljs-attr">resultMap</span>=<span class="hljs-string">&quot;emp&quot;</span>&gt;</span><br> select * from tbl_employee where id = #&#123;id&#125;<br><span class="hljs-tag">&lt;/<span class="hljs-name">select</span>&gt;</span><br></code></pre></div></td></tr></table></figure>

<p>事实上，对于主键列，你也可以使用result标签来指定规则， 但是使用id标签的好处就是MyBatis会知道该属性是主键从而自动设置一些功能，对于一些属性名和列名已经一致的属性，你也可以不进行自定义，MyBatis还是会自动进行封装的。</p>
<p>resultMap可以用来解决数据表的联合查询问题，现有两张数据表，一张员工表：</p>
<figure class="highlight sql"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs sql"><span class="hljs-operator">+</span><span class="hljs-comment">-----------+--------------+------+-----+---------+----------------+</span><br><span class="hljs-operator">|</span> Field <span class="hljs-operator">|</span> Type <span class="hljs-operator">|</span> <span class="hljs-keyword">Null</span> <span class="hljs-operator">|</span> Key <span class="hljs-operator">|</span> <span class="hljs-keyword">Default</span> <span class="hljs-operator">|</span> Extra <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">-----------+--------------+------+-----+---------+----------------+</span><br><span class="hljs-operator">|</span> id <span class="hljs-operator">|</span> <span class="hljs-type">int</span>(<span class="hljs-number">11</span>) <span class="hljs-operator">|</span> <span class="hljs-keyword">NO</span> <span class="hljs-operator">|</span> PRI <span class="hljs-operator">|</span> <span class="hljs-keyword">NULL</span> <span class="hljs-operator">|</span> auto_increment <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> last_name <span class="hljs-operator">|</span> <span class="hljs-type">varchar</span>(<span class="hljs-number">255</span>) <span class="hljs-operator">|</span> YES <span class="hljs-operator">|</span>     <span class="hljs-operator">|</span> <span class="hljs-keyword">NULL</span> <span class="hljs-operator">|</span>                <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> gender <span class="hljs-operator">|</span> <span class="hljs-type">char</span>(<span class="hljs-number">1</span>) <span class="hljs-operator">|</span> YES <span class="hljs-operator">|</span> <span class="hljs-operator">|</span> <span class="hljs-keyword">NULL</span> <span class="hljs-operator">|</span> <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> email <span class="hljs-operator">|</span> <span class="hljs-type">varchar</span>(<span class="hljs-number">255</span>) <span class="hljs-operator">|</span> YES <span class="hljs-operator">|</span>     <span class="hljs-operator">|</span> <span class="hljs-keyword">NULL</span> <span class="hljs-operator">|</span>                <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> d_id <span class="hljs-operator">|</span> <span class="hljs-type">int</span>(<span class="hljs-number">11</span>) <span class="hljs-operator">|</span> YES <span class="hljs-operator">|</span> MUL <span class="hljs-operator">|</span> <span class="hljs-keyword">NULL</span> <span class="hljs-operator">|</span> <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">-----------+--------------+------+-----+---------+----------------+</span><br></code></pre></div></td></tr></table></figure>

<p>一张部门表：</p>
<figure class="highlight sql"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs sql"><span class="hljs-operator">+</span><span class="hljs-comment">-----------+--------------+------+-----+---------+----------------+</span><br><span class="hljs-operator">|</span> Field <span class="hljs-operator">|</span> Type <span class="hljs-operator">|</span> <span class="hljs-keyword">Null</span> <span class="hljs-operator">|</span> Key <span class="hljs-operator">|</span> <span class="hljs-keyword">Default</span> <span class="hljs-operator">|</span> Extra <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">-----------+--------------+------+-----+---------+----------------+</span><br><span class="hljs-operator">|</span> id <span class="hljs-operator">|</span> <span class="hljs-type">int</span>(<span class="hljs-number">11</span>) <span class="hljs-operator">|</span> <span class="hljs-keyword">NO</span> <span class="hljs-operator">|</span> PRI <span class="hljs-operator">|</span> <span class="hljs-keyword">NULL</span> <span class="hljs-operator">|</span> auto_increment <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> dept_name <span class="hljs-operator">|</span> <span class="hljs-type">varchar</span>(<span class="hljs-number">255</span>) <span class="hljs-operator">|</span> YES <span class="hljs-operator">|</span>     <span class="hljs-operator">|</span> <span class="hljs-keyword">NULL</span> <span class="hljs-operator">|</span>                <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">-----------+--------------+------+-----+---------+----------------+</span><br></code></pre></div></td></tr></table></figure>

<p>其中员工表的d_id列与部门表的id列存在外键约束关系。</p>
<p>若有这样的需求，查询员工表的某位员工信息，同时查出它的部门信息，该需求涉及到联合查询的问题，resultMap则能够很好地解决这一问题。</p>
<p>首先我们创建两张数据表对应的类，员工类：</p>
<figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.wwj.mybatis.bean;<br><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Employee</span> </span>&#123;<br> <br> <span class="hljs-keyword">private</span> Integer id;<br> <span class="hljs-keyword">private</span> String lastName;<br> <span class="hljs-keyword">private</span> String email;<br> <span class="hljs-keyword">private</span> String gender;<br> <span class="hljs-keyword">private</span> Department department;<br>    <br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">Employee</span><span class="hljs-params">()</span> </span>&#123;<br>  <br> &#125;<br><br> <span class="hljs-function"><span class="hljs-keyword">public</span> Department <span class="hljs-title">getDepartment</span><span class="hljs-params">()</span> </span>&#123;<br>  <span class="hljs-keyword">return</span> department;<br> &#125;<br><br> <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setDepartment</span><span class="hljs-params">(Department department)</span> </span>&#123;<br>  <span class="hljs-keyword">this</span>.department = department;<br> &#125;<br>    <br> <span class="hljs-function"><span class="hljs-keyword">public</span> Integer <span class="hljs-title">getId</span><span class="hljs-params">()</span> </span>&#123;<br>  <span class="hljs-keyword">return</span> id;<br> &#125;<br> <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setId</span><span class="hljs-params">(Integer id)</span> </span>&#123;<br>  <span class="hljs-keyword">this</span>.id = id;<br> &#125;<br> <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">getLastName</span><span class="hljs-params">()</span> </span>&#123;<br>  <span class="hljs-keyword">return</span> lastName;<br> &#125;<br> <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setLastName</span><span class="hljs-params">(String lastName)</span> </span>&#123;<br>  <span class="hljs-keyword">this</span>.lastName = lastName;<br> &#125;<br> <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">getEmail</span><span class="hljs-params">()</span> </span>&#123;<br>  <span class="hljs-keyword">return</span> email;<br> &#125;<br> <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setEmail</span><span class="hljs-params">(String email)</span> </span>&#123;<br>  <span class="hljs-keyword">this</span>.email = email;<br> &#125;<br> <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">getGender</span><span class="hljs-params">()</span> </span>&#123;<br>  <span class="hljs-keyword">return</span> gender;<br> &#125;<br> <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setGender</span><span class="hljs-params">(String gender)</span> </span>&#123;<br>  <span class="hljs-keyword">this</span>.gender = gender;<br> &#125;<br>&#125;<br></code></pre></div></td></tr></table></figure>



<p>部门类：</p>
<figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.wwj.mybatis.bean;<br><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Department</span> </span>&#123;<br> <br> <span class="hljs-keyword">private</span> Integer id;<br> <span class="hljs-keyword">private</span> String departmentName;<br> <br> <span class="hljs-function"><span class="hljs-keyword">public</span> Integer <span class="hljs-title">getId</span><span class="hljs-params">()</span> </span>&#123;<br>  <span class="hljs-keyword">return</span> id;<br> &#125;<br> <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setId</span><span class="hljs-params">(Integer id)</span> </span>&#123;<br>  <span class="hljs-keyword">this</span>.id = id;<br> &#125;<br> <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">getDepartmentName</span><span class="hljs-params">()</span> </span>&#123;<br>  <span class="hljs-keyword">return</span> departmentName;<br> &#125;<br> <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setDepartmentName</span><span class="hljs-params">(String departmentName)</span> </span>&#123;<br>  <span class="hljs-keyword">this</span>.departmentName = departmentName;<br> &#125;<br>&#125;<br></code></pre></div></td></tr></table></figure>



<p>那么接下来就非常简单了，在接口中定义查询方法：</p>
<figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">public</span> Employee <span class="hljs-title">getEmpAndDept</span><span class="hljs-params">(Integer id)</span></span>;<br></code></pre></div></td></tr></table></figure>

<p>编写sql配置：</p>
<figure class="highlight xml"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">resultMap</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;employee&quot;</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;empy&quot;</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">id</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;id&quot;</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;id&quot;</span>/&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;last_name&quot;</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;lastName&quot;</span>/&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;gender&quot;</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;gender&quot;</span>/&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;did&quot;</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;dept.id&quot;</span>/&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;dept_name&quot;</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;dept.departmentName&quot;</span>/&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">resultMap</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">select</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;getEmpAndDept&quot;</span> <span class="hljs-attr">resultMap</span>=<span class="hljs-string">&quot;empy&quot;</span>&gt;</span><br> select * from tbl_employee e,tbl_dept d where e.d_id=d.id and e.id=#&#123;id&#125;<br><span class="hljs-tag">&lt;/<span class="hljs-name">select</span>&gt;</span><br></code></pre></div></td></tr></table></figure>



<p>这里通过级联属性为部门类的属性定义规则。</p>
<p>除了级联属性，你也可以使用association标签来定义规则：</p>
<figure class="highlight xml"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">resultMap</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;employee&quot;</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;empy&quot;</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">id</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;id&quot;</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;id&quot;</span>/&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;last_name&quot;</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;lastName&quot;</span>/&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;gender&quot;</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;gender&quot;</span>/&gt;</span><br>  <span class="hljs-comment">&lt;!--</span><br><span class="hljs-comment">   association可以指定联合的Java对象</span><br><span class="hljs-comment">  property:指定哪个属性为联合的Java对象</span><br><span class="hljs-comment">  javaType:指定联合Java对象的类型</span><br><span class="hljs-comment"> --&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">association</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;dept&quot;</span> <span class="hljs-attr">javaType</span>=<span class="hljs-string">&quot;com.wwj.mybatis.bean.Department&quot;</span>&gt;</span><br>   <span class="hljs-tag">&lt;<span class="hljs-name">id</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;did&quot;</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;id&quot;</span>/&gt;</span><br>   <span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;dept_name&quot;</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;departmentName&quot;</span>/&gt;</span><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">association</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">resultMap</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">select</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;getEmpAndDept&quot;</span> <span class="hljs-attr">resultMap</span>=<span class="hljs-string">&quot;empy&quot;</span>&gt;</span><br>  select * from tbl_employee e,tbl_dept d where e.d_id=d.id and e.id=#&#123;id&#125;<br><span class="hljs-tag">&lt;/<span class="hljs-name">select</span>&gt;</span><br></code></pre></div></td></tr></table></figure>

<p>而有些情况，我们在查询员工信息的时候并不需要查询它的部门信息，此时可以使用延迟加载，实现非常简单，在MyBatis的配置文件中进行两个配置即可：</p>
<figure class="highlight xml"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">settings</span>&gt;</span><br> <span class="hljs-tag">&lt;<span class="hljs-name">setting</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;lazyLoadingEnabled&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;true&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">setting</span>&gt;</span><br> <span class="hljs-tag">&lt;<span class="hljs-name">setting</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;aggressiveLazyLoading&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;false&quot;</span>/&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">settings</span>&gt;</span><br></code></pre></div></td></tr></table></figure>

<p>此时当我们不去查询员工的部门信息时，Mybatis就不会发送sql去查询部门表，避免了资源的浪费。</p>
<p>而当查询对象中包含集合数据时，比如：</p>
<figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.wwj.mybatis.bean;<br><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Department</span> </span>&#123;<br> <br> <span class="hljs-keyword">private</span> Integer id;<br> <span class="hljs-keyword">private</span> String departmentName;<br> <span class="hljs-keyword">private</span> List&lt;Employee&gt; emps;<br> <br> <span class="hljs-function"><span class="hljs-keyword">public</span> List&lt;Employee&gt; <span class="hljs-title">getEmps</span><span class="hljs-params">()</span> </span>&#123;<br>  <span class="hljs-keyword">return</span> emps;<br> &#125;<br> <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setEmps</span><span class="hljs-params">(List&lt;Employee&gt; emps)</span> </span>&#123;<br>  <span class="hljs-keyword">this</span>.emps = emps;<br> &#125;<br> <span class="hljs-function"><span class="hljs-keyword">public</span> Integer <span class="hljs-title">getId</span><span class="hljs-params">()</span> </span>&#123;<br>  <span class="hljs-keyword">return</span> id;<br> &#125;<br> <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setId</span><span class="hljs-params">(Integer id)</span> </span>&#123;<br>  <span class="hljs-keyword">this</span>.id = id;<br> &#125;<br> <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">getDepartmentName</span><span class="hljs-params">()</span> </span>&#123;<br>  <span class="hljs-keyword">return</span> departmentName;<br> &#125;<br> <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setDepartmentName</span><span class="hljs-params">(String departmentName)</span> </span>&#123;<br>  <span class="hljs-keyword">this</span>.departmentName = departmentName;<br> &#125;<br> <span class="hljs-meta">@Override</span><br> <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">toString</span><span class="hljs-params">()</span> </span>&#123;<br>  <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;Department [id=&quot;</span> + id + <span class="hljs-string">&quot;, departmentName=&quot;</span> + departmentName + <span class="hljs-string">&quot;, emps=&quot;</span> + emps + <span class="hljs-string">&quot;]&quot;</span>;<br> &#125;<br>&#125;<br></code></pre></div></td></tr></table></figure>



<p>一个部门包含若干员工，这些员工将封装到一个集合中，该如何对其进行处理呢？</p>
<p>在接口中定义方法：</p>
<figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">public</span> Department <span class="hljs-title">getDeptById</span><span class="hljs-params">(Integer id)</span></span>;<br></code></pre></div></td></tr></table></figure>

<p>sql配置：</p>
<figure class="highlight xml"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">resultMap</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;com.wwj.mybatis.bean.Department&quot;</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;MyDept&quot;</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">id</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;did&quot;</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;id&quot;</span>/&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;dept_name&quot;</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;departmentName&quot;</span>/&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">collection</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;emps&quot;</span> <span class="hljs-attr">ofType</span>=<span class="hljs-string">&quot;com.wwj.mybatis.bean.Employee&quot;</span>&gt;</span><br>   <span class="hljs-comment">&lt;!-- 定义集合中的元素封装规则 --&gt;</span><br>   <span class="hljs-tag">&lt;<span class="hljs-name">id</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;eid&quot;</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;id&quot;</span>/&gt;</span><br>   <span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;last_name&quot;</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;lastName&quot;</span>/&gt;</span><br>   <span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;email&quot;</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;email&quot;</span>/&gt;</span><br>   <span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;gender&quot;</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;gender&quot;</span>/&gt;</span><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">collection</span>&gt;</span><br> <span class="hljs-tag">&lt;/<span class="hljs-name">resultMap</span>&gt;</span><br> <span class="hljs-comment">&lt;!-- 查询部门的时候将部门对应的所有员工信息查询出来 --&gt;</span><br> <span class="hljs-tag">&lt;<span class="hljs-name">select</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;getDeptById&quot;</span> <span class="hljs-attr">resultMap</span>=<span class="hljs-string">&quot;MyDept&quot;</span>&gt;</span><br>  SELECT * FROM tbl_dept d LEFT JOIN tbl_employee e ON d.id=e.d_id WHERE d.id=#&#123;id&#125;<br> <span class="hljs-tag">&lt;/<span class="hljs-name">select</span>&gt;</span><br></code></pre></div></td></tr></table></figure>

<p>其中collection用于定义集合中的元素封装规则，ofType属性指定集合的元素类型。</p>
<h3 id="Mybatis的缓存机制"><a href="#Mybatis的缓存机制" class="headerlink" title="Mybatis的缓存机制"></a><strong>Mybatis的缓存机制</strong></h3><p>先来看这样一个场景：</p>
<figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@Test</span><br><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">test12</span><span class="hljs-params">()</span></span>&#123;<br>    EmployeeMapper mapper = sqlSession.getMapper(EmployeeMapper.class);<br>    Employee employee = mapper.getEmpById(<span class="hljs-number">1</span>);<br>    Employee employee2 = mapper.getEmpById(<span class="hljs-number">1</span>);<br>    System.out.println(employee == employee2);<br>&#125;<br></code></pre></div></td></tr></table></figure>

<p>按照我们的想法，两次查询都会从数据库中获取一个对象，结果应该是false才对，但是查看控制台：</p>
<figure class="highlight shell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell">DEBUG 09-18 11:39:06,191 ==&gt; Preparing: select * from tbl_employee where id = ? (BaseJdbcLogger.java:145)<br>DEBUG 09-18 11:39:06,267 ==&gt; Parameters: 1(Integer) (BaseJdbcLogger.java:145)<br>DEBUG 09-18 11:39:06,304 &lt;== Total: 1  (BaseJdbcLogger.java:145)<br>true<br></code></pre></div></td></tr></table></figure>

<p>结果却是true，这是MyBatis缓存机制的效果，那它有什么好处呢？对于一个项目来说，某些数据是基本不会发生改变且需要在页面之间互相传递的，对于这些数据，它需要在各个页面之间频繁地查询，为此，可以将它们在第一次查询之后就放入缓存中，等接下来需要用到这些数据时，直接从缓存中获取而不是去查询数据库，大大提升了运行效率。</p>
<p>这里的缓存采用的是MyBatis的一级缓存，也叫sqlSession级别缓存，默认是一直开启的，因为是sqlSession级别缓存，所以每个sqlSession都拥有自己的缓存，两个sqlSession之间是不能互相访问自己的缓存的。</p>
<p>比如：</p>
<figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@Test</span><br><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">test12</span><span class="hljs-params">()</span></span>&#123;<br>    SqlSession sqlSession2 = sqlSessionFactory.openSession();<br>    EmployeeMapper mapper = sqlSession.getMapper(EmployeeMapper.class);<br>    EmployeeMapper mapper2 = sqlSession2.getMapper(EmployeeMapper.class);<br>    Employee employee = mapper.getEmpById(<span class="hljs-number">1</span>);<br>    Employee employee2 = mapper2.getEmpById(<span class="hljs-number">1</span>);<br>    System.out.println(employee == employee2);<br>&#125;<br></code></pre></div></td></tr></table></figure>

<p>输出结果：</p>
<figure class="highlight sql"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs sql">DEBUG <span class="hljs-number">09</span><span class="hljs-number">-18</span> <span class="hljs-number">11</span>:<span class="hljs-number">50</span>:<span class="hljs-number">29</span>,<span class="hljs-number">516</span> <span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">&gt;</span> Preparing: <span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> tbl_employee <span class="hljs-keyword">where</span> id <span class="hljs-operator">=</span> ? (BaseJdbcLogger.java:<span class="hljs-number">145</span>)<br>DEBUG <span class="hljs-number">09</span><span class="hljs-number">-18</span> <span class="hljs-number">11</span>:<span class="hljs-number">50</span>:<span class="hljs-number">29</span>,<span class="hljs-number">590</span> <span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">&gt;</span> Parameters: <span class="hljs-number">1</span>(<span class="hljs-type">Integer</span>) (BaseJdbcLogger.java:<span class="hljs-number">145</span>)<br>DEBUG <span class="hljs-number">09</span><span class="hljs-number">-18</span> <span class="hljs-number">11</span>:<span class="hljs-number">50</span>:<span class="hljs-number">29</span>,<span class="hljs-number">659</span> <span class="hljs-operator">&lt;=</span><span class="hljs-operator">=</span> Total: <span class="hljs-number">1</span>  (BaseJdbcLogger.java:<span class="hljs-number">145</span>)<br>DEBUG <span class="hljs-number">09</span><span class="hljs-number">-18</span> <span class="hljs-number">11</span>:<span class="hljs-number">50</span>:<span class="hljs-number">29</span>,<span class="hljs-number">674</span> <span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">&gt;</span> Preparing: <span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> tbl_employee <span class="hljs-keyword">where</span> id <span class="hljs-operator">=</span> ? (BaseJdbcLogger.java:<span class="hljs-number">145</span>)<br>DEBUG <span class="hljs-number">09</span><span class="hljs-number">-18</span> <span class="hljs-number">11</span>:<span class="hljs-number">50</span>:<span class="hljs-number">29</span>,<span class="hljs-number">674</span> <span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">&gt;</span> Parameters: <span class="hljs-number">1</span>(<span class="hljs-type">Integer</span>) (BaseJdbcLogger.java:<span class="hljs-number">145</span>)<br>DEBUG <span class="hljs-number">09</span><span class="hljs-number">-18</span> <span class="hljs-number">11</span>:<span class="hljs-number">50</span>:<span class="hljs-number">29</span>,<span class="hljs-number">679</span> <span class="hljs-operator">&lt;=</span><span class="hljs-operator">=</span> Total: <span class="hljs-number">1</span>  (BaseJdbcLogger.java:<span class="hljs-number">145</span>)<br><span class="hljs-literal">false</span><br></code></pre></div></td></tr></table></figure>

<p>若是使用的同一个sqlSession对象，但是在两次查询期间执行了增删改操作，那么查询的数据也不会从一级缓存中获取：</p>
<figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@Test</span><br><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">test12</span><span class="hljs-params">()</span></span>&#123;<br>    EmployeeMapper mapper = sqlSession.getMapper(EmployeeMapper.class);<br>    Employee employee = mapper.getEmpById(<span class="hljs-number">1</span>);<br>    mapper.addEmp(<span class="hljs-keyword">new</span> Employee(<span class="hljs-keyword">null</span>,<span class="hljs-string">&quot;testCache&quot;</span>,<span class="hljs-string">&quot;cache&quot;</span>,<span class="hljs-string">&quot;1&quot;</span>));<br>    Employee employee2 = mapper.getEmpById(<span class="hljs-number">1</span>);<br>    System.out.println(employee == employee2);<br>&#125;<br></code></pre></div></td></tr></table></figure>

<p>输出结果：</p>
<figure class="highlight sql"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs sql">DEBUG <span class="hljs-number">09</span><span class="hljs-number">-18</span> <span class="hljs-number">11</span>:<span class="hljs-number">59</span>:<span class="hljs-number">14</span>,<span class="hljs-number">137</span> <span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">&gt;</span> Preparing: <span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> tbl_employee <span class="hljs-keyword">where</span> id <span class="hljs-operator">=</span> ? (BaseJdbcLogger.java:<span class="hljs-number">145</span>)<br>DEBUG <span class="hljs-number">09</span><span class="hljs-number">-18</span> <span class="hljs-number">11</span>:<span class="hljs-number">59</span>:<span class="hljs-number">14</span>,<span class="hljs-number">337</span> <span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">&gt;</span> Parameters: <span class="hljs-number">1</span>(<span class="hljs-type">Integer</span>) (BaseJdbcLogger.java:<span class="hljs-number">145</span>)<br>DEBUG <span class="hljs-number">09</span><span class="hljs-number">-18</span> <span class="hljs-number">11</span>:<span class="hljs-number">59</span>:<span class="hljs-number">14</span>,<span class="hljs-number">397</span> <span class="hljs-operator">&lt;=</span><span class="hljs-operator">=</span> Total: <span class="hljs-number">1</span>  (BaseJdbcLogger.java:<span class="hljs-number">145</span>)<br>DEBUG <span class="hljs-number">09</span><span class="hljs-number">-18</span> <span class="hljs-number">11</span>:<span class="hljs-number">59</span>:<span class="hljs-number">14</span>,<span class="hljs-number">397</span> <span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">&gt;</span> Preparing: <span class="hljs-keyword">insert</span> <span class="hljs-keyword">into</span> tbl_employee (last_name,email,gender) <span class="hljs-keyword">values</span> (?,?,?) (BaseJdbcLogger.java:<span class="hljs-number">145</span>)<br>DEBUG <span class="hljs-number">09</span><span class="hljs-number">-18</span> <span class="hljs-number">11</span>:<span class="hljs-number">59</span>:<span class="hljs-number">14</span>,<span class="hljs-number">407</span> <span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">&gt;</span> Parameters: testCache(String), cache(String), <span class="hljs-number">1</span>(String) (BaseJdbcLogger.java:<span class="hljs-number">145</span>)<br>DEBUG <span class="hljs-number">09</span><span class="hljs-number">-18</span> <span class="hljs-number">11</span>:<span class="hljs-number">59</span>:<span class="hljs-number">14</span>,<span class="hljs-number">407</span> <span class="hljs-operator">&lt;=</span><span class="hljs-operator">=</span> Updates: <span class="hljs-number">1</span>  (BaseJdbcLogger.java:<span class="hljs-number">145</span>)<br>DEBUG <span class="hljs-number">09</span><span class="hljs-number">-18</span> <span class="hljs-number">11</span>:<span class="hljs-number">59</span>:<span class="hljs-number">14</span>,<span class="hljs-number">407</span> <span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">&gt;</span> Preparing: <span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> tbl_employee <span class="hljs-keyword">where</span> id <span class="hljs-operator">=</span> ? (BaseJdbcLogger.java:<span class="hljs-number">145</span>)<br>DEBUG <span class="hljs-number">09</span><span class="hljs-number">-18</span> <span class="hljs-number">11</span>:<span class="hljs-number">59</span>:<span class="hljs-number">14</span>,<span class="hljs-number">417</span> <span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">&gt;</span> Parameters: <span class="hljs-number">1</span>(<span class="hljs-type">Integer</span>) (BaseJdbcLogger.java:<span class="hljs-number">145</span>)<br>DEBUG <span class="hljs-number">09</span><span class="hljs-number">-18</span> <span class="hljs-number">11</span>:<span class="hljs-number">59</span>:<span class="hljs-number">14</span>,<span class="hljs-number">417</span> <span class="hljs-operator">&lt;=</span><span class="hljs-operator">=</span> Total: <span class="hljs-number">1</span>  (BaseJdbcLogger.java:<span class="hljs-number">145</span>)<br><span class="hljs-literal">false</span><br></code></pre></div></td></tr></table></figure>

<p>因为增删改操作可能会对需要查询的数据做处理，若是在查询之间将这条数据就删除了，结果却还从一级缓存中读取出了数据，那不是乱套了吗？</p>
<p>还可以通过<code>sqlSession.clearCache();</code>手动删除sqlSession缓存。</p>
<p>sqlSession级别的缓存显然不是很友好，因为作用范围实在是太小了，为此，MyBatis提供了二级缓存，也叫namespace级别缓存，它的作用范围是全局的。</p>
<p>当开启一个sqlSession并查询数据之后，该数据会被存入一级缓存，然而当sqlSession关闭以后，一级缓存中的数据理应被清空，但是MyBatis会将这些数据重新放入二级缓存，那么该如何使用二级缓存呢？</p>
<p>首先需要配置一下二级缓存：</p>
<figure class="highlight xml"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">settings</span>&gt;</span><br>    <span class="hljs-comment">&lt;!-- 开启二级缓存 --&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">setting</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;cacheEnabled&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;true&quot;</span>/&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">settings</span>&gt;</span><br></code></pre></div></td></tr></table></figure>

<p>然后在Mapper.xml文件中配置一下：</p>
<figure class="highlight xml"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs xml"><span class="hljs-meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&gt;</span><br><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-meta-keyword">mapper</span></span><br><span class="hljs-meta">        <span class="hljs-meta-keyword">PUBLIC</span> <span class="hljs-meta-string">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span></span><br><span class="hljs-meta">        <span class="hljs-meta-string">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">mapper</span> <span class="hljs-attr">namespace</span>=<span class="hljs-string">&quot;com.wwj.dao.EmployeeMapper&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">cache</span> <span class="hljs-attr">eviction</span>=<span class="hljs-string">&quot;FIFO&quot;</span> <span class="hljs-attr">flushInterval</span>=<span class="hljs-string">&quot;60000&quot;</span> <span class="hljs-attr">readOnly</span>=<span class="hljs-string">&quot;false&quot;</span> <span class="hljs-attr">size</span>=<span class="hljs-string">&quot;1024&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">cache</span>&gt;</span><br>    ......<br><span class="hljs-tag">&lt;/<span class="hljs-name">mapper</span>&gt;</span><br></code></pre></div></td></tr></table></figure>

<p>这里详细介绍一下cache标签的属性：</p>
<ul>
<li><p>eviction：缓存的回收策略</p>
</li>
<li><ul>
<li><p>LRU：最近最少使用的，移除最长时间没有被使用的对象</p>
</li>
<li><p>FIFO：先进先出，按对象进入缓存的顺序来移除它们</p>
</li>
<li><p>SOFT：软引用，移除基于垃圾回收器状态和软引用规则的对象</p>
</li>
<li><p>WEAK：弱引用，更积极地移除基于垃圾回收器状态和弱引用规则的对象</p>
<p>默认回收策略为LRU</p>
</li>
</ul>
</li>
<li><p>flushInterval：缓存的刷新间隔(设置一个毫秒值)，即多长时间清空一次缓存，MyBatis默认是不清空缓存的</p>
</li>
<li><p>readOnly：缓存是否只读</p>
</li>
<li><ul>
<li>true：只读 若设置为只读，则MyBatis会认为所有从缓存中获取数据的操作都是只读操作，不会修改数据 为了加快获取数据，会直接将数据在缓存中的引用交给开发者;优点:效率高，缺点:不安全</li>
<li>false：非只读 若设置为非只读，则MyBatis会认为从缓存中获取的数据可能会被修改 所以会通过序列化与反序列化克隆一份新的数据交给开发者;优点:安全，缺点:效率低</li>
</ul>
</li>
<li><p>size：缓存存放多少个元素</p>
</li>
<li><p>type：指定自定义缓存全类名，将实现Cache接口类的全类名作为属性值传入即可,这里type使用默认值</p>
</li>
</ul>
<p>因为我们将readOnly设置为了false，所以需要让Employee类实现Serializable接口。</p>
<figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@Test</span><br><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">test13</span><span class="hljs-params">()</span></span>&#123;<br>    SqlSession sqlSession = sqlSessionFactory.openSession();<br>    SqlSession sqlSession2 = sqlSessionFactory.openSession();<br>    EmployeeMapper mapper = sqlSession.getMapper(EmployeeMapper.class);<br>    EmployeeMapper mapper2 = sqlSession2.getMapper(EmployeeMapper.class);<br>    Employee employee = mapper.getEmpById(<span class="hljs-number">1</span>);<br>    sqlSession.close();<br>    Employee employee2 = mapper2.getEmpById(<span class="hljs-number">1</span>);<br>    sqlSession2.close();<br>&#125;<br></code></pre></div></td></tr></table></figure>

<p>运行结果：</p>
<figure class="highlight sql"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs sql">DEBUG <span class="hljs-number">09</span><span class="hljs-number">-18</span> <span class="hljs-number">12</span>:<span class="hljs-number">50</span>:<span class="hljs-number">55</span>,<span class="hljs-number">598</span> Cache Hit Ratio [com.wwj.dao.EmployeeMapper]: <span class="hljs-number">0.0</span>  (LoggingCache.java:<span class="hljs-number">62</span>)<br>DEBUG <span class="hljs-number">09</span><span class="hljs-number">-18</span> <span class="hljs-number">12</span>:<span class="hljs-number">50</span>:<span class="hljs-number">55</span>,<span class="hljs-number">646</span> <span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">&gt;</span> Preparing: <span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> tbl_employee <span class="hljs-keyword">where</span> id <span class="hljs-operator">=</span> ? (BaseJdbcLogger.java:<span class="hljs-number">145</span>)<br>DEBUG <span class="hljs-number">09</span><span class="hljs-number">-18</span> <span class="hljs-number">12</span>:<span class="hljs-number">50</span>:<span class="hljs-number">55</span>,<span class="hljs-number">736</span> <span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">&gt;</span> Parameters: <span class="hljs-number">1</span>(<span class="hljs-type">Integer</span>) (BaseJdbcLogger.java:<span class="hljs-number">145</span>)<br>DEBUG <span class="hljs-number">09</span><span class="hljs-number">-18</span> <span class="hljs-number">12</span>:<span class="hljs-number">50</span>:<span class="hljs-number">55</span>,<span class="hljs-number">788</span> <span class="hljs-operator">&lt;=</span><span class="hljs-operator">=</span> Total: <span class="hljs-number">1</span>  (BaseJdbcLogger.java:<span class="hljs-number">145</span>)<br>DEBUG <span class="hljs-number">09</span><span class="hljs-number">-18</span> <span class="hljs-number">12</span>:<span class="hljs-number">50</span>:<span class="hljs-number">55</span>,<span class="hljs-number">894</span> Cache Hit Ratio [com.wwj.dao.EmployeeMapper]: <span class="hljs-number">0.5</span>  (LoggingCache.java:<span class="hljs-number">62</span>)<br></code></pre></div></td></tr></table></figure>

<p>可以看到MyBatis的确只发了一条sql语句，使用二级缓存需要注意的一点是，只有当sqlSession被关闭之后，数据才会被放入二级缓存，所以如果是这样就不对了：</p>
<figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@Test</span><br><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">test13</span><span class="hljs-params">()</span></span>&#123;<br>    SqlSession sqlSession = sqlSessionFactory.openSession();<br>    SqlSession sqlSession2 = sqlSessionFactory.openSession();<br>    EmployeeMapper mapper = sqlSession.getMapper(EmployeeMapper.class);<br>    EmployeeMapper mapper2 = sqlSession2.getMapper(EmployeeMapper.class);<br>    Employee employee = mapper.getEmpById(<span class="hljs-number">1</span>);<br>    Employee employee2 = mapper2.getEmpById(<span class="hljs-number">1</span>);<br>    System.out.println(employee == employee2);<br>    sqlSession.close();<br>    sqlSession2.close();<br>&#125;<br></code></pre></div></td></tr></table></figure>

<p>还需要注意的是，二级缓存是namespace级别的缓存，所以只有当你在对应的Mapper.xml文件中配置了cache节点，该Mapper才有二级缓存。</p>
<p>以上便是有关MyBatis的全部内容了。</p>

            </div>
            <hr>
            <div>
              <div class="post-metas mb-3">
                
                  <div class="post-meta mr-3">
                    <i class="iconfont icon-category"></i>
                    
                      <a class="hover-with-bg" href="/categories/Java/">Java</a>
                    
                      <a class="hover-with-bg" href="/categories/Java/Mybatis/">Mybatis</a>
                    
                  </div>
                
                
                  <div class="post-meta">
                    <i class="iconfont icon-tags"></i>
                    
                      <a class="hover-with-bg" href="/tags/Java/">Java</a>
                    
                      <a class="hover-with-bg" href="/tags/Mybatis/">Mybatis</a>
                    
                  </div>
                
              </div>
              
                <p class="note note-warning">
                  
                    本博客所有文章除特别声明外，均采用 <a target="_blank" href="https://creativecommons.org/licenses/by-sa/4.0/deed.zh" rel="nofollow noopener noopener">CC BY-SA 4.0 协议</a> ，转载请注明出处！
                  
                </p>
              
              
                <div class="post-prevnext">
                  <article class="post-prev col-6">
                    
                    
                      <a href="/2021/10/13/MyBatis-Plus%20%E7%9C%8B%E8%BF%99%E7%AF%87%E5%B0%B1%E5%A4%9F%E4%BA%86/">
                        <i class="iconfont icon-arrowleft"></i>
                        <span class="hidden-mobile">MyBatis-Plus 看这篇就够了</span>
                        <span class="visible-mobile">上一篇</span>
                      </a>
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/2021/10/13/MyBatis%20%E5%A6%82%E4%BD%95%E6%89%BE%E5%88%B0%E8%A6%81%E6%89%A7%E8%A1%8C%E7%9A%84%20SQL%20%EF%BC%9F/">
                        <span class="hidden-mobile">MyBatis 如何找到要执行的 SQL ？</span>
                        <span class="visible-mobile">下一篇</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
          </article>
        </div>
      </div>
    </div>
    
      <div class="d-none d-lg-block col-lg-2 toc-container" id="toc-ctn">
        <div id="toc">
  <p class="toc-header"><i class="iconfont icon-list"></i>&nbsp;目录</p>
  <div class="toc-body" id="toc-body"></div>
</div>

      </div>
    
  </div>
</div>

<!-- Custom -->


    

    
      <a id="scroll-top-button" aria-label="TOP" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">搜索</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v"
                 for="local-search-input">关键词</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>
    

    
  </main>

  <footer class="text-center mt-5 py-3">
  <div class="footer-content">
     <a href="https://github.com/xiaobeibi" target="_blank" rel="nofollow noopener"><span>Github</span></a> <i class="iconfont icon-love"></i> <a href="https://gitee.com/tytokongjian" target="_blank" rel="nofollow noopener"><span>Gitee</span></a> 
  </div>
  
  <div class="statistics">
    
    

    
      
        <!-- 不蒜子统计PV -->
        <span id="busuanzi_container_site_pv" style="display: none">
            总访问量 
            <span id="busuanzi_value_site_pv"></span>
             次
          </span>
      
      
        <!-- 不蒜子统计UV -->
        <span id="busuanzi_container_site_uv" style="display: none">
            总访客数 
            <span id="busuanzi_value_site_uv"></span>
             人
          </span>
      
    
  </div>


  

  
</footer>


  <!-- SCRIPTS -->
  
  <script  src="https://cdn.jsdelivr.net/npm/nprogress@0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/nprogress@0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js" ></script>
<script  src="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/js/bootstrap.min.js" ></script>
<script  src="/js/events.js" ></script>
<script  src="/js/plugins.js" ></script>

<!-- Plugins -->


  <script  src="/js/local-search.js" ></script>



  
    <script  src="/js/img-lazyload.js" ></script>
  



  



  
    <script  src="https://cdn.jsdelivr.net/npm/tocbot@4/dist/tocbot.min.js" ></script>
  
  
    <script  src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3/dist/jquery.fancybox.min.js" ></script>
  
  
    <script  src="https://cdn.jsdelivr.net/npm/anchor-js@4/anchor.min.js" ></script>
  
  
    <script defer src="https://cdn.jsdelivr.net/npm/clipboard@2/dist/clipboard.min.js" ></script>
  



  <script defer src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" ></script>




  <script  src="https://cdn.jsdelivr.net/npm/typed.js@2/lib/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var title = document.getElementById('subtitle').title;
      
      typing(title)
      
    })(window, document);
  </script>















<!-- 主题的启动项 保持在最底部 -->
<script  src="/js/boot.js" ></script>


</body>
</html>
